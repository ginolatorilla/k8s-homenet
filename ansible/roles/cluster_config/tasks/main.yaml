---
- name: Install kubectl
  community.general.homebrew:
    name: kubernetes-cli

- name: Apply initial manifests
  ansible.builtin.command: kubectl apply -k {{ item }}
  environment:
    KUBECONFIG: "{{ kubeconfig }}"
  register: cluster_config_kubectl_apply
  changed_when: cluster_config_kubectl_apply.rc != 0
  loop:
    - ../kubernetes/core/10-ingress-controller
    - ../kubernetes/core/20-argocd
    - ../kubernetes/core/30-argocd-app-of-apps
